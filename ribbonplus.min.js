/*!
 * RibbonPlus
 * Copyright 2016, Aymeric (@aymkdn)
 * Contact: http://kodono.info
 * Documentation: http://aymkdn.github.com/RibbonPlus/
 * License: MIT License (https://github.com/Aymkdn/RibbonPlus/blob/master/LICENSE)
 */
var RibbonPlus=function(){var n=this;this.ribbon=null,this.isReady=!1,this.pageManager=null,this.RibbonPlusPageComponent=function(){this.getId=function(){return"RibbonPlusPageComponent"},this._commands=[],this._handledCommands={},this.init=function(){},this.getGlobalCommands=function(){return this._commands},this.handleCommand=function(n,e,i){return this._handledCommands[n].handler(n,e,i)},this.canHandleCommand=function(){return!0},this.isFocusable=function(){return!1}},this.ready=function(e){var i=function(){try{n.pageManager=SP.Ribbon.PageManager.get_instance(),n.pageManager.add_ribbonInited(function(){n.ribbon=SP.Ribbon.PageManager.get_instance().get_ribbon(),n.isReady||(n.isReady=!0,e.call(n))});var t=null;try{t=n.pageManager.get_ribbon()}catch(o){reject(o)}t?(n.ribbon=SP.Ribbon.PageManager.get_instance().get_ribbon(),n.isReady||(n.isReady=!0,e.call(n))):"function"==typeof _ribbonStartInit&&(_ribbonStartInit(_ribbon.initialTabId,!1,null),setTimeout(function(){i()},1500))}catch(o){reject(o)}};SP.SOD.executeOrDelayUntilScriptLoaded(function(){i()},"sp.ribbon.js")},this.addTab=function(e,i){if(!e||"string"!=typeof e)throw new Error("[RibbonPlus.addTab] The `tab name` is required.");i||(i={}),i.id||(i.id="RibbonPlus."+e.replace(/\W/g,"")),i.contextual||(i.contextual=!1);var t,o,a,r,b,d,s,l,u,c=!1,r=new CUI.Tab(this.ribbon,i.id,e,i.description||"",i.id+".Command",i.contextual,i.contextualGroupId,null,null);if(i.before){for(b in n.ribbon)if(n.ribbon.hasOwnProperty(b)&&n.ribbon[b]instanceof CUI.List)for(t=n.ribbon[b].getEnumerator(),o=0;t.moveNext();){if(l=t.get_current(),a=l.get_title(),a.toLowerCase()===i.before.toLowerCase()){n.ribbon.addChildAtIndex(r,o),d=n.ribbon[b];for(s in d)if(d.hasOwnProperty(s)&&d[s]instanceof CUI.ListNode&&!d[s].previous){l=d[s];do l.previous&&(l.previous=u),u=l;while(null!==(l=l.next))}c=!0;break}o++}c||n.ribbon.addChild(r)}else this.ribbon.addChild(r);n.ribbon.refresh()},this.addGroup=function(e,i,t){var o,a;if(!e||!i)throw new Error("[RibbonPlus.addGroup] Arguments are required.");if(t||(t={}),o=n.ribbon.getChildByTitle(e),!o)throw new Error("[RibbonPlus.addGroup] The tab with the name `"+e+"` doesn't exist.");t.id||(t.id=o.get_id()+"."+i.replace(/\W/g,"")),a=new CUI.Group(n.ribbon,t.id,i,"","",null),o.addChild(a),n.ribbon.refresh()},this.addButtons=function(e,t,o){if(!e||!t||!o)throw new Error("[RibbonPlus.addButtons] Arguments are required.");if("[object Array]"!==Object.prototype.toString.call(o))throw new Error("[RibbonPlus.addButtons] `buttons` must be an array.");var a,r,b,d,s,l,u,c,h=o.length;if(o.length>3)throw new Error("[RibbonPlus.addButtons] You cannot add more than 3 (small) buttons at a time.");if(d=n.ribbon.getChildByTitle(e),!d)throw new Error("[RibbonPlus.addButton] The tab with the name `"+e+"` doesn't exist.");for(s in d)if(d.hasOwnProperty(s)&&d[s]instanceof CUI.List){if(r=d.getChildByTitle(t),!r)throw new Error("[RibbonPlus.addButton] The group `"+t+"` cannot be found in the tab `"+e+"`.");a=r.get_selectedLayout(),a||(a=new CUI.Layout(n.ribbon,"RibbonPlus.Layout.Id."+(new Date).getTime(),"RibbonPlus.Layout.Title."+(new Date).getTime()),r.addChild(a)),b=new CUI.Section(n.ribbon,"RibbonPlus.Section."+(new Date).getTime(),h+1,0),a.addChild(b);var m=new n.RibbonPlusPageComponent;for(i=0;i<h;i++)o[i].id="RibbonPlus."+e.replace(/\W/g,"")+"."+t.replace(/\W/g,"")+"."+o[i].name.replace(/\W/g,""),1===h?o[i].small=!!o[i].small:o[i].small=!0,"function"!=typeof o[i].onclick&&(o[i].onclick=function(){}),l=new CUI.ControlProperties,l.Command=o[i].id+".Command",l.Id=o[i].id+".ControlProperties",l.TemplateAlias="o1",l.ToolTipDescription=o[i].description||"",o[i].small?l.Image16by16=o[i].image||"/_layouts/15/images/discussHS.png":l.Image32by32=o[i].image||"/_layouts/15/images/placeholder32x32.png",l.ToolTipTitle=o[i].descriptionTitle||"",l.LabelText=o[i].name||"Unnamed",m._handledCommands[l.Command]={handler:o[i].onclick},m._commands.push(l.Command),o[i].button=new CUI.Controls.Button(n.ribbon,o[i].id,l),u=o[i].button.createComponentForDisplayMode(o[i].small?"Medium":"Large"),c=b.getRow(i+1),c.addChild(u);r.selectLayout(a.get_title());break}for(n.pageManager.addPageComponent(m),SelectRibbonTab(d.get_id(),!0),i=0;i<h;i++)o[i].button.set_enabled(!0);n.ribbon.refresh()}};
