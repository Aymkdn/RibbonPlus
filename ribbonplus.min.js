/*!
 * RibbonPlus
 * Copyright 2016, Aymeric (@aymkdn)
 * Contact: http://kodono.info
 * Documentation: http://aymkdn.github.com/RibbonPlus/
 * License: MIT License (https://github.com/Aymkdn/RibbonPlus/blob/master/LICENSE)
 */
var RibbonPlus=function(){var e=this;this.ribbon=null,this.isReady=!1,this.pageManager=null,this.RibbonPlusPageComponent=function(){this.getId=function(){return"RibbonPlusPageComponent"},this._commands=[],this._handledCommands={},this.init=function(){},this.getGlobalCommands=function(){return this._commands},this.handleCommand=function(i,e,n){return this._handledCommands[i].handler(i,e,n)},this.canHandleCommand=function(){return!0},this.isFocusable=function(){return!1}},this.ready=function(i){var n=function(){try{e.pageManager=SP.Ribbon.PageManager.get_instance(),e.pageManager.add_ribbonInited(function(){e.ribbon=SP.Ribbon.PageManager.get_instance().get_ribbon(),e.isReady||(e.isReady=!0,i.call(e))});var t=null;try{t=e.pageManager.get_ribbon()}catch(o){reject(o)}t?(e.ribbon=SP.Ribbon.PageManager.get_instance().get_ribbon(),e.isReady||(e.isReady=!0,i.call(e))):"function"==typeof _ribbonStartInit&&(_ribbonStartInit(_ribbon.initialTabId,!1,null),setTimeout(function(){n()},1500))}catch(o){console.warn(o)}};SP.SOD.executeOrDelayUntilScriptLoaded(function(){n()},"sp.ribbon.js")},this.addTab=function(i,n){if(!i||"string"!=typeof i)throw new Error("[RibbonPlus.addTab] The `tab name` is required.");n||(n={}),n.id||(n.id="RibbonPlus."+i.replace(/\W/g,"")),n.contextual||(n.contextual=!1);var t,o,a,r,s,b,l,d,u,c=!1,r=new CUI.Tab(this.ribbon,n.id,i,n.description||"",n.id+".Command",n.contextual,n.contextualGroupId,null,null);if(n.before){for(s in e.ribbon)if(e.ribbon.hasOwnProperty(s)&&e.ribbon[s]instanceof CUI.List)for(t=e.ribbon[s].getEnumerator(),o=0;t.moveNext();){if(d=t.get_current(),a=d.get_title(),a.toLowerCase()===n.before.toLowerCase()){e.ribbon.addChildAtIndex(r,o),b=e.ribbon[s];for(l in b)if(b.hasOwnProperty(l)&&b[l]instanceof CUI.ListNode&&!b[l].previous){d=b[l];do d.previous&&(d.previous=u),u=d;while(null!==(d=d.next))}c=!0;break}o++}c||e.ribbon.addChild(r)}else this.ribbon.addChild(r);e.ribbon.refresh()},this.addGroup=function(i,n,t){var o,a;if(!i||!n)throw new Error("[RibbonPlus.addGroup] Arguments are required.");if(t||(t={}),o=e.ribbon.getChildByTitle(i),!o)throw new Error("[RibbonPlus.addGroup] The tab with the name `"+i+"` doesn't exist.");var r=o.get_id();return $get(r)?(t.id||(t.id=o.get_id()+"."+n.replace(/\W/g,"")),a=new CUI.Group(e.ribbon,t.id,n,"","",null),o.addChild(a),void e.ribbon.refresh()):(SelectRibbonTab(r,!0),this.waitForTab.apply(this,[r,"addGroup"].concat(Array.prototype.slice.call(arguments))),this)},this.waitForTab=function(i){var e=this,n=Array.prototype.slice.call(arguments);$get(i)?e[n[1]].apply(e,n.slice(2)):setTimeout(function(){e.waitForTab.apply(e,n)},50)},this.addButtons=function(n,t,o){if(!n||!t||!o)throw new Error("[RibbonPlus.addButtons] Arguments are required.");if("[object Array]"!==Object.prototype.toString.call(o))throw new Error("[RibbonPlus.addButtons] `buttons` must be an array.");var a,r,s,b,l,d,u,c,h=o.length;if(o.length>3)throw new Error("[RibbonPlus.addButtons] You cannot add more than 3 (small) buttons at a time.");if(b=e.ribbon.getChildByTitle(n),!b)throw new Error("[RibbonPlus.addButton] The tab with the name `"+n+"` doesn't exist.");var g=b.get_id();if(!$get(g))return SelectRibbonTab(g,!0),this.waitForTab.apply(this,[g,"addButtons"].concat(Array.prototype.slice.call(arguments))),this;for(l in b)if(b.hasOwnProperty(l)&&b[l]instanceof CUI.List){if(r=b.getChildByTitle(t),!r)throw new Error("[RibbonPlus.addButton] The group `"+t+"` cannot be found in the tab `"+n+"`.");a=r.get_selectedLayout(),a||(a=new CUI.Layout(e.ribbon,"RibbonPlus.Layout.Id."+(new Date).getTime(),"RibbonPlus.Layout.Title."+(new Date).getTime()),r.addChild(a)),s=new CUI.Section(e.ribbon,"RibbonPlus.Section."+(new Date).getTime(),h+1,0),a.addChild(s);var m=new e.RibbonPlusPageComponent;for(i=0;i<h;i++)o[i].id="RibbonPlus."+n.replace(/\W/g,"")+"."+t.replace(/\W/g,"")+"."+o[i].name.replace(/\W/g,""),1===h?o[i].small=!!o[i].small:o[i].small=!0,"function"!=typeof o[i].onclick&&(o[i].onclick=function(){}),d=new CUI.ControlProperties,d.Command=o[i].id+".Command",d.Id=o[i].id+".ControlProperties",d.TemplateAlias="o1",d.ToolTipDescription=o[i].description||"",o[i].small?(d.Image16by16=o[i].image||"/_layouts/15/images/discussHS.png",d.Image16by16Class=o[i].cssClass||""):(d.Image32by32=o[i].image||"/_layouts/15/images/placeholder32x32.png",d.Image32by32Class=o[i].cssClass||""),d.ToolTipTitle=o[i].descriptionTitle||o[i].name,d.LabelText=o[i].name||"Unnamed",m._handledCommands[d.Command]={handler:o[i].onclick},m._commands.push(d.Command),o[i].button=new CUI.Controls.Button(e.ribbon,o[i].id,d),u=o[i].button.createComponentForDisplayMode(o[i].small?"Medium":"Large"),c=s.getRow(i+1),c.addChild(u);r.selectLayout(a.get_title());break}for(e.pageManager.addPageComponent(m),SelectRibbonTab(g,!0),i=0;i<h;i++)o[i].button.set_enabled(!0);e.ribbon.refresh()}};
