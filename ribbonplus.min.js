/*!
 * RibbonPlus
 * Copyright 2016, Aymeric (@aymkdn)
 * Contact: http://kodono.info
 * Documentation: http://aymkdn.github.com/RibbonPlus/
 * License: MIT License (https://github.com/Aymkdn/RibbonPlus/blob/master/LICENSE)
 */
var RibbonPlus=function(){var n=this;this.ribbon=null,this.pageManager=null,this.RibbonPlusPageComponent=function(){this.getId=function(){return"RibbonPlusPageComponent"},this._commands=[],this._handledCommands={},this.init=function(){},this.getGlobalCommands=function(){return this._commands},this.handleCommand=function(n,e,i){return this._handledCommands[n].handler(n,e,i)},this.canHandleCommand=function(){return!0},this.isFocusable=function(){return!1}},this.ready=function(e){var i=function(){try{n.pageManager=SP.Ribbon.PageManager.get_instance(),n.pageManager.add_ribbonInited(function(){n.ribbon=SP.Ribbon.PageManager.get_instance().get_ribbon(),e.call(n)});var t=null;try{t=n.pageManager.get_ribbon()}catch(o){reject(o)}t?(n.ribbon=SP.Ribbon.PageManager.get_instance().get_ribbon(),e.call(n)):"function"==typeof _ribbonStartInit&&(_ribbonStartInit(_ribbon.initialTabId,!1,null),setTimeout(function(){i()},1500))}catch(o){reject(o)}};SP.SOD.executeOrDelayUntilScriptLoaded(function(){i()},"sp.ribbon.js")},this.addTab=function(e,i){if(!e||"string"!=typeof e)throw new Error("[RibbonPlus.addTab] The `tab name` is required.");i||(i={}),i.id||(i.id="RibbonPlus."+e.replace(/\W/g,"")),i.contextual||(i.contextual=!1);var t,o,r,a,b,d,l,s,u,c=!1,a=new CUI.Tab(this.ribbon,i.id,e,i.description||"",i.id+".Command",i.contextual,i.contextualGroupId,null,null);if(i.before){for(b in n.ribbon)if(n.ribbon.hasOwnProperty(b)&&n.ribbon[b]instanceof CUI.List)for(t=n.ribbon[b].getEnumerator(),o=0;t.moveNext();){if(s=t.get_current(),r=s.get_title(),r.toLowerCase()===i.before.toLowerCase()){n.ribbon.addChildAtIndex(a,o),d=n.ribbon[b];for(l in d)if(d.hasOwnProperty(l)&&d[l]instanceof CUI.ListNode&&!d[l].previous){s=d[l];do s.previous&&(s.previous=u),u=s;while(null!==(s=s.next))}c=!0;break}o++}c||n.ribbon.addChild(a)}else this.ribbon.addChild(a);n.ribbon.refresh()},this.addGroup=function(e,i,t){var o,r;if(!e||!i)throw new Error("[RibbonPlus.addGroup] Arguments are required.");if(t||(t={}),o=n.ribbon.getChildByTitle(e),!o)throw new Error("[RibbonPlus.addGroup] The tab with the name `"+e+"` doesn't exist.");t.id||(t.id=o.get_id()+"."+i.replace(/\W/g,"")),r=new CUI.Group(n.ribbon,t.id,i,"","",null),o.addChild(r),n.ribbon.refresh()},this.addButtons=function(e,t,o){if(!e||!t||!o)throw new Error("[RibbonPlus.addButtons] Arguments are required.");if("[object Array]"!==Object.prototype.toString.call(o))throw new Error("[RibbonPlus.addButtons] `buttons` must be an array.");var r,a,b,d,l,s,u,c,h=o.length;if(o.length>3)throw new Error("[RibbonPlus.addButtons] You cannot add more than 3 (small) buttons at a time.");if(d=n.ribbon.getChildByTitle(e),!d)throw new Error("[RibbonPlus.addButton] The tab with the name `"+e+"` doesn't exist.");for(l in d)if(d.hasOwnProperty(l)&&d[l]instanceof CUI.List){if(a=d.getChildByTitle(t),!a)throw new Error("[RibbonPlus.addButton] The group `"+t+"` cannot be found in the tab `"+e+"`.");r=a.get_selectedLayout(),r||(r=new CUI.Layout(n.ribbon,"RibbonPlus.Layout.Id."+(new Date).getTime(),"RibbonPlus.Layout.Title."+(new Date).getTime()),a.addChild(r)),b=new CUI.Section(n.ribbon,"RibbonPlus.Section."+(new Date).getTime(),h+1,0),r.addChild(b);var m=new n.RibbonPlusPageComponent;for(i=0;i<h;i++)o[i].id="RibbonPlus."+e.replace(/\W/g,"")+"."+t.replace(/\W/g,"")+"."+o[i].name.replace(/\W/g,""),1===h?o[i].small=!!o[i].small:o[i].small=!0,"function"!=typeof o[i].onclick&&(o[i].onclick=function(){}),s=new CUI.ControlProperties,s.Command=o[i].id+".Command",s.Id=o[i].id+".ControlProperties",s.TemplateAlias="o1",s.ToolTipDescription=o[i].description||"",o[i].small?s.Image16by16=o[i].image||"/_layouts/15/images/discussHS.png":s.Image32by32=o[i].image||"/_layouts/15/images/placeholder32x32.png",s.ToolTipTitle=o[i].descriptionTitle||"",s.LabelText=o[i].name||"Unnamed",m._handledCommands[s.Command]={handler:o[i].onclick},m._commands.push(s.Command),o[i].button=new CUI.Controls.Button(n.ribbon,o[i].id,s),u=o[i].button.createComponentForDisplayMode(o[i].small?"Medium":"Large"),c=b.getRow(i+1),c.addChild(u);a.selectLayout(r.get_title());break}for(n.pageManager.addPageComponent(m),SelectRibbonTab(d.get_id(),!0),i=0;i<h;i++)o[i].button.set_enabled(!0);n.ribbon.refresh()}};
